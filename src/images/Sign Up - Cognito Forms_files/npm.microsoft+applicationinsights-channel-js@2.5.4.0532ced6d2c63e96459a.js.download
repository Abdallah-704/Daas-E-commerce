(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{702:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var n=r(19),a=r(29),i=r(25),s=r(24),o=function(){function e(e){this._config=e,this._buffer=[]}return e.prototype.enqueue=function(e){this._buffer.push(e)},e.prototype.count=function(){return this._buffer.length},e.prototype.clear=function(){this._buffer.length=0},e.prototype.getItems=function(){return this._buffer.slice(0)},e.prototype.batchPayloads=function(e){return e&&e.length>0?this._config.emitLineDelimitedJson()?e.join("\n"):"["+e.join(",")+"]":null},e.prototype.markAsSent=function(e){this.clear()},e.prototype.clearSent=function(e){},e}(),l=function(){function e(t,r){this._bufferFullMessageSent=!1,this._logger=t,this._config=r;var n=this.getBuffer(e.BUFFER_KEY),a=this.getBuffer(e.SENT_BUFFER_KEY);this._buffer=n.concat(a),this._buffer.length>e.MAX_BUFFER_SIZE&&(this._buffer.length=e.MAX_BUFFER_SIZE),this.setBuffer(e.SENT_BUFFER_KEY,[]),this.setBuffer(e.BUFFER_KEY,this._buffer)}return e.prototype.enqueue=function(t){this._buffer.length>=e.MAX_BUFFER_SIZE?this._bufferFullMessageSent||(this._logger.throwInternal(i.a.WARNING,i.b.SessionStorageBufferFull,"Maximum buffer size reached: "+this._buffer.length,!0),this._bufferFullMessageSent=!0):(this._buffer.push(t),this.setBuffer(e.BUFFER_KEY,this._buffer))},e.prototype.count=function(){return this._buffer.length},e.prototype.clear=function(){this._buffer.length=0,this.setBuffer(e.BUFFER_KEY,[]),this.setBuffer(e.SENT_BUFFER_KEY,[]),this._bufferFullMessageSent=!1},e.prototype.getItems=function(){return this._buffer.slice(0)},e.prototype.batchPayloads=function(e){return e&&e.length>0?this._config.emitLineDelimitedJson()?e.join("\n"):"["+e.join(",")+"]":null},e.prototype.markAsSent=function(t){this._buffer=this.removePayloadsFromBuffer(t,this._buffer),this.setBuffer(e.BUFFER_KEY,this._buffer);var r=this.getBuffer(e.SENT_BUFFER_KEY);r instanceof Array&&t instanceof Array&&((r=r.concat(t)).length>e.MAX_BUFFER_SIZE&&(this._logger.throwInternal(i.a.CRITICAL,i.b.SessionStorageBufferFull,"Sent buffer reached its maximum size: "+r.length,!0),r.length=e.MAX_BUFFER_SIZE),this.setBuffer(e.SENT_BUFFER_KEY,r))},e.prototype.clearSent=function(t){var r=this.getBuffer(e.SENT_BUFFER_KEY);r=this.removePayloadsFromBuffer(t,r),this.setBuffer(e.SENT_BUFFER_KEY,r)},e.prototype.removePayloadsFromBuffer=function(e,t){var r=[];for(var n in t){var a=!1;for(var i in e)if(e[i]===t[n]){a=!0;break}a||r.push(t[n])}return r},e.prototype.getBuffer=function(e){var t=e;try{t=this._config.namePrefix&&this._config.namePrefix()?this._config.namePrefix()+"_"+t:t;var r=a.e.getSessionStorage(this._logger,t);if(r){var n=Object(s.e)().parse(r);if(n)return n}}catch(e){this._logger.throwInternal(i.a.CRITICAL,i.b.FailedToRestoreStorageBuffer," storage key: "+t+", "+a.e.getExceptionName(e),{exception:a.e.dump(e)})}return[]},e.prototype.setBuffer=function(e,t){var r=e;try{r=this._config.namePrefix&&this._config.namePrefix()?this._config.namePrefix()+"_"+r:r;var n=JSON.stringify(t);a.e.setSessionStorage(this._logger,r,n)}catch(e){a.e.setSessionStorage(this._logger,r,JSON.stringify([])),this._logger.throwInternal(i.a.WARNING,i.b.FailedToSetStorageBuffer," storage key: "+r+", "+a.e.getExceptionName(e)+". Buffer cleared",{exception:a.e.dump(e)})}},e.BUFFER_KEY="AI_buffer",e.SENT_BUFFER_KEY="AI_sentBuffer",e.MAX_BUFFER_SIZE=2e3,e}(),u=r(410),d=r(64),c=r(172),p=r(411),f=r(393),h=r(391),g=r(409),_=r(408),m=r(392),b=r(413),y=r(412),v=r(18),I=function(){function e(){}return e.extractPropsAndMeasurements=function(e,t,r){if(!v.a.isNullOrUndefined(e))for(var n in e)if(e.hasOwnProperty(n)){var a=e[n];v.a.isNumber(a)?r[n]=a:v.a.isString(a)?t[n]=a:Object(s.k)()&&(t[n]=Object(s.e)().stringify(a))}},e.createEnvelope=function(t,r,n,a){var i=new u.a(t,a,r);n[d.e]&&(i.sampleRate=n[d.e]),i.iKey=n.iKey;var s=n.iKey.replace(/-/g,"");return i.name=i.name.replace("{0}",s),e.extractPartAExtensions(n,i),n.tags||(n.tags=[]),i},e.extractPartAExtensions=function(t,r){if(r.tags||(r.tags={}),t.ext||(t.ext={}),t.tags||(t.tags=[]),t.ext.user){t.ext.user.authId&&(r.tags[c.a.userAuthUserId]=t.ext.user.authId);var a=t.ext.user.id||t.ext.user.localId;a&&(r.tags[c.a.userId]=a)}if(t.ext.app&&t.ext.app.sesId&&(r.tags[c.a.sessionId]=t.ext.app.sesId),t.ext.device&&((t.ext.device.id||t.ext.device.localId)&&(r.tags[c.a.deviceId]=t.ext.device.id||t.ext.device.localId),t.ext.device.deviceClass&&(r.tags[c.a.deviceType]=t.ext.device.deviceClass),t.ext.device.ip&&(r.tags[c.a.deviceIp]=t.ext.device.ip)),t.ext.web){var i=t.ext.web;i.browserLang&&(r.tags[c.a.deviceLanguage]=i.browserLang),i.browserVer&&(r.tags[c.a.deviceBrowserVersion]=i.browserVer),i.browser&&(r.tags[c.a.deviceBrowser]=i.browser),r.data=r.data||{},r.data.baseData=r.data.baseData||{},r.data.baseData.properties=r.data.baseData.properties||{},i.domain&&(r.data.baseData.properties.domain=i.domain),i.isManual&&(r.data.baseData.properties.isManual=i.isManual.toString()),i.screenRes&&(r.data.baseData.properties.screenRes=i.screenRes),i.userConsent&&(r.data.baseData.properties.userConsent=i.userConsent.toString())}t.ext.device&&t.ext.device.model&&(r.tags[c.a.deviceModel]=t.ext.device.model),t.ext.os&&t.ext.os.name&&(r.tags[c.a.deviceOS]=t.ext.os.name),t.ext.device&&t.ext.device.deviceType&&(r.tags[c.a.deviceType]=t.ext.device.deviceType),t.ext.trace&&(t.ext.trace.parentID&&(r.tags[c.a.operationParentId]=t.ext.trace.parentID),t.ext.trace.name&&(r.tags[c.a.operationName]=t.ext.trace.name),t.ext.trace.traceID&&(r.tags[c.a.operationId]=t.ext.trace.traceID));for(var s={},o=function(e){var r=t.tags[e];v.a.arrForEach(v.a.objKeys(r),(function(e){s[e]=r[e]})),t.tags.splice(e,1)},l=t.tags.length-1;l>=0;l--)o(l);for(var u in t.tags)s[u]=t.tags[u];r.tags=n.a({},r.tags,s),r.tags[c.a.internalSdkVersion]||(r.tags[c.a.internalSdkVersion]="javascript:"+e.Version)},e.Version="2.5.4",e}(),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r=t.baseData.measurements||{},n=t.baseData.properties||{};I.extractPropsAndMeasurements(t.data,n,r);var a=t.baseData;if(v.a.isNullOrUndefined(a))return e.warnToConsole("Invalid input for dependency data"),null;var s=a.id,o=a.target,l=a.name,u=a.duration,c=a.success,h=a.responseCode,g=a.type,_=a.correlationContext,m=a.properties&&a.properties[d.c]?a.properties[d.c]:"GET",b=new p.a(e,s,o,l,u,c,h,m,g,_,n,r),y=new f.a(p.a.dataType,b);return I.createEnvelope(e,p.a.envelopeType,t,y)},t.DependencyEnvelopeCreator=new t,t}(I),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r={},n={};t.baseType!==h.a.dataType&&(r.baseTypeSource=t.baseType),t.baseType===h.a.dataType?(r=t.baseData.properties||{},n=t.baseData.measurements||{}):t.baseData&&I.extractPropsAndMeasurements(t.baseData,r,n),I.extractPropsAndMeasurements(t.data,r,n);var a=t.baseData.name,s=new h.a(e,a,r,n),o=new f.a(h.a.dataType,s);return I.createEnvelope(e,h.a.envelopeType,t,o)},t.EventEnvelopeCreator=new t,t}(I),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r=t.baseData,n=g.a.CreateFromInterface(e,r),a=new f.a(g.a.dataType,n);return I.createEnvelope(e,g.a.envelopeType,t,a)},t.ExceptionEnvelopeCreator=new t,t}(I),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r=t.baseData.properties||{},n=t.baseData.measurements||{};I.extractPropsAndMeasurements(t.data,r,n);var a=t.baseData.name,s=t.baseData.average,o=t.baseData.sampleCount,l=t.baseData.min,u=t.baseData.max,d=new _.a(e,a,s,o,l,u,r,n),c=new f.a(_.a.dataType,d);return I.createEnvelope(e,_.a.envelopeType,t,c)},t.MetricEnvelopeCreator=new t,t}(I),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){var r;this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null."),v.a.isNullOrUndefined(t.baseData)||v.a.isNullOrUndefined(t.baseData.properties)||v.a.isNullOrUndefined(t.baseData.properties.duration)?v.a.isNullOrUndefined(t.data)||v.a.isNullOrUndefined(t.data.duration)||(r=t.data.duration,delete t.data.duration):(r=t.baseData.properties.duration,delete t.baseData.properties.duration);var n,a=t.baseData;t.ext&&t.ext.trace&&t.ext.trace.traceID&&(n=t.ext.trace.traceID);var s=a.id||n,o=a.name,l=a.uri,u=a.properties||{},d=a.measurements||{};if(v.a.isNullOrUndefined(a.refUri)||(u.refUri=a.refUri),v.a.isNullOrUndefined(a.pageType)||(u.pageType=a.pageType),v.a.isNullOrUndefined(a.isLoggedIn)||(u.isLoggedIn=a.isLoggedIn.toString()),!v.a.isNullOrUndefined(a.properties)){var c=a.properties;for(var p in c)c.hasOwnProperty(p)&&(u[p]=c[p])}I.extractPropsAndMeasurements(t.data,u,d);var h=new m.a(e,o,l,r,u,d,s),g=new f.a(m.a.dataType,h);return I.createEnvelope(e,m.a.envelopeType,t,g)},t.PageViewEnvelopeCreator=new t,t}(I),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r=t.baseData,n=r.name,a=r.uri||r.url,s=r.properties||{},o=r.measurements||{};I.extractPropsAndMeasurements(t.data,s,o);var l=new b.a(e,n,a,void 0,s,o,r),u=new f.a(b.a.dataType,l);return I.createEnvelope(e,b.a.envelopeType,t,u)},t.PageViewPerformanceEnvelopeCreator=new t,t}(I),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.b(t,e),t.prototype.Create=function(e,t){this._logger=e,v.a.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(i.a.CRITICAL,i.b.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.");var r=t.baseData.message,n=t.baseData.severityLevel,a=t.baseData.properties||{},s=t.baseData.measurements||{};I.extractPropsAndMeasurements(t.data,a,s);var o=new y.a(e,r,n,a,s),l=new f.a(y.a.dataType,o);return I.createEnvelope(e,y.a.envelopeType,t,l)},t.TraceEnvelopeCreator=new t,t}(I),A=r(16),D=function(){function e(e){this._logger=e}return e.prototype.serialize=function(e){var t=this._serializeObject(e,"root");try{return Object(s.e)().stringify(t)}catch(e){this._logger.throwInternal(i.a.CRITICAL,i.b.CannotSerializeObject,e&&v.a.isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}},e.prototype._serializeObject=function(e,t){var r={};if(!e)return this._logger.throwInternal(i.a.CRITICAL,i.b.CannotSerializeObject,"cannot serialize object because it is null or undefined",{name:t},!0),r;if(e.__aiCircularRefCheck)return this._logger.throwInternal(i.a.WARNING,i.b.CircularReferenceDetected,"Circular reference detected while serializing object",{name:t},!0),r;if(!e.aiDataContract){if("measurements"===t)r=this._serializeStringMap(e,"number",t);else if("properties"===t)r=this._serializeStringMap(e,"string",t);else if("tags"===t)r=this._serializeStringMap(e,"string",t);else if(a.e.isArray(e))r=this._serializeArray(e,t);else{this._logger.throwInternal(i.a.WARNING,i.b.CannotSerializeObjectNonSerializable,"Attempting to serialize an object which does not implement ISerializable",{name:t},!0);try{Object(s.e)().stringify(e),r=e}catch(e){this._logger.throwInternal(i.a.CRITICAL,i.b.CannotSerializeObject,e&&v.a.isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}}return r}for(var n in e.__aiCircularRefCheck=!0,e.aiDataContract){var o=e.aiDataContract[n],l=v.a.isFunction(o)?o()&A.b.Required:o&A.b.Required,u=v.a.isFunction(o)?o()&A.b.Hidden:o&A.b.Hidden,d=o&A.b.Array,c=void 0!==e[n],p=v.a.isObject(e[n])&&null!==e[n];if(!l||c||d){if(!u){var f=void 0;void 0!==(f=p?d?this._serializeArray(e[n],n):this._serializeObject(e[n],n):e[n])&&(r[n]=f)}}else this._logger.throwInternal(i.a.CRITICAL,i.b.MissingRequiredFieldSpecification,"Missing required field specification. The field is required but not present on source",{field:n,name:t})}return delete e.__aiCircularRefCheck,r},e.prototype._serializeArray=function(e,t){var r;if(e)if(a.e.isArray(e)){r=[];for(var n=0;n<e.length;n++){var s=e[n],o=this._serializeObject(s,t+"["+n+"]");r.push(o)}}else this._logger.throwInternal(i.a.CRITICAL,i.b.ItemNotInArray,"This field was specified as an array in the contract but the item is not an array.\r\n",{name:t},!0);return r},e.prototype._serializeStringMap=function(e,t,r){var n;if(e)for(var a in n={},e){var s=e[a];if("string"===t)void 0===s?n[a]="undefined":null===s?n[a]="null":s.toString?n[a]=s.toString():n[a]="invalid field: toString() is not defined.";else if("number"===t)if(void 0===s)n[a]="undefined";else if(null===s)n[a]="null";else{var o=parseFloat(s);isNaN(o)?n[a]="NaN":n[a]=o}else n[a]="invalid field: "+r+" is of unknown type.",this._logger.throwInternal(i.a.CRITICAL,n[a],null,!0)}return n},e}(),N=r(31),F=r(141),L=r(416),B=function(){function e(){this._onlineStatus=!0;var e=Object(s.i)(),t=Object(s.a)(),r=!1;try{if(e&&v.b.Attach(e,"online",this._setOnline.bind(this))&&(v.b.Attach(e,"offline",this._setOffline.bind(this)),r=!0),t){var n=t.body||t;v.a.isUndefined(n.ononline)||(n.ononline=this._setOnline.bind(this),n.onoffline=this._setOffline.bind(this),r=!0)}}catch(e){r=!1}this.isListening=r}return e.prototype.isOnline=function(){var e=Object(s.g)();return this.isListening?this._onlineStatus:!(e&&!v.a.isNullOrUndefined(e.onLine))||e.onLine},e.prototype.isOffline=function(){return!this.isOnline()},e.prototype._setOnline=function(){this._onlineStatus=!0},e.prototype._setOffline=function(){this._onlineStatus=!1},e.Offline=new e,e}().Offline,O=function(){function e(){}return e.prototype.getHashCodeScore=function(t){return 100*(this.getHashCode(t)/e.INT_MAX_VALUE)},e.prototype.getHashCode=function(t){if(""===t)return 0;for(;t.length<e.MIN_INPUT_LENGTH;)t=t.concat(t);for(var r=5381,n=0;n<t.length;++n)r=(r<<5)+r+t.charCodeAt(n),r&=r;return Math.abs(r)},e.INT_MAX_VALUE=2147483647,e.MIN_INPUT_LENGTH=8,e}(),U=r(144),M=function(){function e(){this.hashCodeGeneragor=new O,this.keys=new U.a}return e.prototype.getSamplingScore=function(e){return e.tags&&e.tags[this.keys.userId]?this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.userId]):e.ext&&e.ext.user&&e.ext.user.id?this.hashCodeGeneragor.getHashCodeScore(e.ext.user.id):e.tags&&e.tags[this.keys.operationId]?this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.operationId]):e.ext&&e.ext.telemetryTrace&&e.ext.telemetryTrace.traceID?this.hashCodeGeneragor.getHashCodeScore(e.ext.telemetryTrace.traceID):100*Math.random()},e}(),P=r(110),z=function(){function e(e,t){this.INT_MAX_VALUE=2147483647,this._logger=v.a.isNullOrUndefined(t)?new P.a:t,(e>100||e<0)&&(this._logger.throwInternal(i.a.WARNING,i.b.SampleRateOutOfRange,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),this.sampleRate=100),this.sampleRate=e,this.samplingScoreGenerator=new M}return e.prototype.isSampledIn=function(e){var t=this.sampleRate;return null==t||t>=100||(e.baseType===_.a.dataType||this.samplingScoreGenerator.getSamplingScore(e)<t)},e}();function j(e){try{return e.responseText}catch(e){}return null}var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.priority=1001,t.identifier=N.BreezeChannelIdentifier,t._XMLHttpRequestSupported=!1,t}return n.b(t,e),t.constructEnvelope=function(e,t,r){var a;switch((a=t===e.iKey||v.a.isNullOrUndefined(t)?e:n.a({},e,{iKey:t})).baseType){case h.a.dataType:return S.EventEnvelopeCreator.Create(r,a);case y.a.dataType:return x.TraceEnvelopeCreator.Create(r,a);case m.a.dataType:return w.PageViewEnvelopeCreator.Create(r,a);case b.a.dataType:return R.PageViewPerformanceEnvelopeCreator.Create(r,a);case g.a.dataType:return E.ExceptionEnvelopeCreator.Create(r,a);case _.a.dataType:return T.MetricEnvelopeCreator.Create(r,a);case p.a.dataType:return C.DependencyEnvelopeCreator.Create(r,a);default:return S.EventEnvelopeCreator.Create(r,a)}},t._getDefaultAppInsightsChannelConfig=function(){return{endpointUrl:function(){return"https://dc.services.visualstudio.com/v2/track"},emitLineDelimitedJson:function(){return!1},maxBatchInterval:function(){return 15e3},maxBatchSizeInBytes:function(){return 102400},disableTelemetry:function(){return!1},enableSessionStorageBuffer:function(){return!0},isRetryDisabled:function(){return!1},isBeaconApiDisabled:function(){return!0},onunloadDisableBeacon:function(){return!1},instrumentationKey:function(){},namePrefix:function(){},samplingPercentage:function(){return 100}}},t._getEmptyAppInsightsChannelConfig=function(){return{endpointUrl:void 0,emitLineDelimitedJson:void 0,maxBatchInterval:void 0,maxBatchSizeInBytes:void 0,disableTelemetry:void 0,enableSessionStorageBuffer:void 0,isRetryDisabled:void 0,isBeaconApiDisabled:void 0,onunloadDisableBeacon:void 0,instrumentationKey:void 0,namePrefix:void 0,samplingPercentage:void 0}},t.prototype.pause=function(){throw new Error("Method not implemented.")},t.prototype.resume=function(){throw new Error("Method not implemented.")},t.prototype.flush=function(){try{this.triggerSend()}catch(e){this.diagLog().throwInternal(i.a.CRITICAL,i.b.FlushFailed,"flush failed, telemetry will not be collected: "+a.e.getExceptionName(e),{exception:a.e.dump(e)})}},t.prototype.onunloadFlush=function(){if(!1!==this._senderConfig.onunloadDisableBeacon()&&!1!==this._senderConfig.isBeaconApiDisabled()||!a.e.IsBeaconApiSupported())this.flush();else try{this.triggerSend(!0,this._beaconSender)}catch(e){this.diagLog().throwInternal(i.a.CRITICAL,i.b.FailedToSendQueuedTelemetry,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+a.e.getExceptionName(e),{exception:a.e.dump(e)})}},t.prototype.teardown=function(){throw new Error("Method not implemented.")},t.prototype.initialize=function(r,n,i,s){e.prototype.initialize.call(this,r,n,i,s);var u=this._getTelCtx(),d=this.identifier;this._serializer=new D(n.logger),this._consecutiveErrors=0,this._retryAt=null,this._lastSend=0,this._sender=null;var c=t._getDefaultAppInsightsChannelConfig();this._senderConfig=t._getEmptyAppInsightsChannelConfig();var p=function(e){f._senderConfig[e]=function(){return u.getConfig(d,e,c[e]())}},f=this;for(var h in c)p(h);(this._buffer=this._senderConfig.enableSessionStorageBuffer&&a.e.canUseSessionStorage()?new l(this.diagLog(),this._senderConfig):new o(this._senderConfig),this._sample=new z(this._senderConfig.samplingPercentage(),this.diagLog()),!this._senderConfig.isBeaconApiDisabled()&&a.e.IsBeaconApiSupported())?this._sender=this._beaconSender:v.a.isUndefined(XMLHttpRequest)||("withCredentials"in new XMLHttpRequest?(this._sender=this._xhrSender,this._XMLHttpRequestSupported=!0):v.a.isUndefined(XDomainRequest)||(this._sender=this._xdrSender))},t.prototype.processTelemetry=function(e,r){r=this._getTelCtx(r);try{if(this._senderConfig.disableTelemetry())return;if(!e)return void r.diagLog().throwInternal(i.a.CRITICAL,i.b.CannotSendEmptyTelemetry,"Cannot send empty telemetry");if(e.baseData&&!e.baseType)return void r.diagLog().throwInternal(i.a.CRITICAL,i.b.InvalidEvent,"Cannot send telemetry without baseData and baseType");if(e.baseType||(e.baseType="EventData"),!this._sender)return void r.diagLog().throwInternal(i.a.CRITICAL,i.b.SenderNotInitialized,"Sender was not initialized");if(!this._isSampledIn(e))return void r.diagLog().throwInternal(i.a.WARNING,i.b.TelemetrySampledAndNotSent,"Telemetry item was sampled out and not sent",{SampleRate:this._sample.sampleRate});e[d.e]=this._sample.sampleRate;var n=t.constructEnvelope(e,this._senderConfig.instrumentationKey(),r.diagLog());if(!n)return void r.diagLog().throwInternal(i.a.CRITICAL,i.b.CreateEnvelopeError,"Unable to create an AppInsights envelope");var s=!1;if(e.tags&&e.tags[d.d]&&(v.a.arrForEach(e.tags[d.d],(function(e){try{e&&!1===e(n)&&(s=!0,r.diagLog().warnToConsole("Telemetry processor check returns false"))}catch(e){r.diagLog().throwInternal(i.a.CRITICAL,i.b.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+a.e.getExceptionName(e),{exception:a.e.dump(e)},!0)}})),delete e.tags[d.d]),s)return;var o=this._serializer.serialize(n),l=this._buffer.getItems(),u=this._buffer.batchPayloads(l);u&&u.length+o.length>this._senderConfig.maxBatchSizeInBytes()&&this.triggerSend(),this._buffer.enqueue(o),this._setupTimer()}catch(e){r.diagLog().throwInternal(i.a.WARNING,i.b.FailedAddingTelemetryToBuffer,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+a.e.getExceptionName(e),{exception:a.e.dump(e)})}this.processNext(e,r)},t.prototype._xhrReadyStateChange=function(e,t,r){if(4===e.readyState){var n=null;if(this._appId||(n=this._parseResponse(j(e)||e.response))&&n.appId&&(this._appId=n.appId),(e.status<200||e.status>=300)&&0!==e.status)!this._senderConfig.isRetryDisabled()&&this._isRetriable(e.status)?(this._resendPayload(t),this.diagLog().throwInternal(i.a.WARNING,i.b.TransmissionFailed,". Response code "+e.status+". Will retry to send "+t.length+" items.")):this._onError(t,this._formatErrorMessageXhr(e));else if(B.isOffline()){if(!this._senderConfig.isRetryDisabled()){this._resendPayload(t,10),this.diagLog().throwInternal(i.a.WARNING,i.b.TransmissionFailed,". Offline - Response Code: "+e.status+". Offline status: "+B.isOffline()+". Will retry to send "+t.length+" items.")}}else 206===e.status?(n||(n=this._parseResponse(j(e)||e.response)),n&&!this._senderConfig.isRetryDisabled()?this._onPartialSuccess(t,n):this._onError(t,this._formatErrorMessageXhr(e))):(this._consecutiveErrors=0,this._onSuccess(t,r))}},t.prototype.triggerSend=function(e,t){void 0===e&&(e=!0);try{if(this._senderConfig.disableTelemetry())this._buffer.clear();else{if(this._buffer.count()>0){var r=this._buffer.getItems();t?t.call(this,r,e):this._sender(r,e)}this._lastSend=+new Date}clearTimeout(this._timeoutHandle),this._timeoutHandle=null,this._retryAt=null}catch(e){(!a.e.getIEVersion()||a.e.getIEVersion()>9)&&this.diagLog().throwInternal(i.a.CRITICAL,i.b.TransmissionFailed,"Telemetry transmission failed, some telemetry will be lost: "+a.e.getExceptionName(e),{exception:a.e.dump(e)})}},t.prototype._onError=function(e,t,r){this.diagLog().throwInternal(i.a.WARNING,i.b.OnError,"Failed to send telemetry.",{message:t}),this._buffer.clearSent(e)},t.prototype._onPartialSuccess=function(e,t){for(var r=[],n=[],a=0,s=t.errors.reverse();a<s.length;a++){var o=s[a],l=e.splice(o.index,1)[0];this._isRetriable(o.statusCode)?n.push(l):r.push(l)}e.length>0&&this._onSuccess(e,t.itemsAccepted),r.length>0&&this._onError(r,this._formatErrorMessageXhr(null,["partial success",t.itemsAccepted,"of",t.itemsReceived].join(" "))),n.length>0&&(this._resendPayload(n),this.diagLog().throwInternal(i.a.WARNING,i.b.TransmissionFailed,"Partial success. Delivered: "+e.length+", Failed: "+r.length+". Will retry to send "+n.length+" our of "+t.itemsReceived+" items"))},t.prototype._onSuccess=function(e,t){this._buffer.clearSent(e)},t.prototype._xdrOnLoad=function(e,t){var r=j(e);if(!e||r+""!="200"&&""!==r){var n=this._parseResponse(r);n&&n.itemsReceived&&n.itemsReceived>n.itemsAccepted&&!this._senderConfig.isRetryDisabled()?this._onPartialSuccess(t,n):this._onError(t,this._formatErrorMessageXdr(e))}else this._consecutiveErrors=0,this._onSuccess(t,0)},t.prototype._isSampledIn=function(e){return this._sample.isSampledIn(e)},t.prototype._beaconSender=function(e,t){var r=this._senderConfig.endpointUrl(),n=this._buffer.batchPayloads(e),a=new Blob([n],{type:"text/plain;charset=UTF-8"});Object(s.g)().sendBeacon(r,a)?(this._buffer.markAsSent(e),this._onSuccess(e,e.length)):(this._xhrSender(e,!0),this.diagLog().throwInternal(i.a.WARNING,i.b.TransmissionFailed,". Failed to send telemetry with Beacon API, retried with xhrSender."))},t.prototype._xhrSender=function(e,t){var r=this,n=new XMLHttpRequest,i=this._senderConfig.endpointUrl();try{n[d.b]=!0}catch(e){}n.open("POST",i,t),n.setRequestHeader("Content-type","application/json"),a.e.isInternalApplicationInsightsEndpoint(i)&&n.setRequestHeader(F.a.sdkContextHeader,F.a.sdkContextHeaderAppIdRequest),n.onreadystatechange=function(){return r._xhrReadyStateChange(n,e,e.length)},n.onerror=function(t){return r._onError(e,r._formatErrorMessageXhr(n),t)};var s=this._buffer.batchPayloads(e);n.send(s),this._buffer.markAsSent(e)},t.prototype._parseResponse=function(e){try{if(e&&""!==e){var t=Object(s.e)().parse(e);if(t&&t.itemsReceived&&t.itemsReceived>=t.itemsAccepted&&t.itemsReceived-t.itemsAccepted===t.errors.length)return t}}catch(t){this.diagLog().throwInternal(i.a.CRITICAL,i.b.InvalidBackendResponse,"Cannot parse the response. "+a.e.getExceptionName(t),{response:e})}return null},t.prototype._resendPayload=function(e,t){if(void 0===t&&(t=1),e&&0!==e.length){this._buffer.clearSent(e),this._consecutiveErrors++;for(var r=0,n=e;r<n.length;r++){var a=n[r];this._buffer.enqueue(a)}this._setRetryTime(t),this._setupTimer()}},t.prototype._setRetryTime=function(e){var t;if(this._consecutiveErrors<=1)t=10;else{var r=(Math.pow(2,this._consecutiveErrors)-1)/2,n=Math.floor(Math.random()*r*10)+1;n*=e,t=Math.max(Math.min(n,3600),10)}var a=Date.now()+1e3*t;this._retryAt=a},t.prototype._setupTimer=function(){var e=this;if(!this._timeoutHandle){var t=this._retryAt?Math.max(0,this._retryAt-Date.now()):0,r=Math.max(this._senderConfig.maxBatchInterval(),t);this._timeoutHandle=setTimeout((function(){e.triggerSend()}),r)}},t.prototype._isRetriable=function(e){return 408===e||429===e||500===e||503===e},t.prototype._formatErrorMessageXhr=function(e,t){return e?"XMLHttpRequest,Status:"+e.status+",Response:"+j(e)||!1:t},t.prototype._xdrSender=function(e,t){var r=this,n=Object(s.i)(),a=new XDomainRequest;a.onload=function(){return r._xdrOnLoad(a,e)},a.onerror=function(t){return r._onError(e,r._formatErrorMessageXdr(a),t)};var o=n&&n.location&&n.location.protocol||"";if(0!==this._senderConfig.endpointUrl().lastIndexOf(o,0))return this.diagLog().throwInternal(i.a.WARNING,i.b.TransmissionFailed,". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."),void this._buffer.clear();var l=this._senderConfig.endpointUrl().replace(/^(https?:)/,"");a.open("POST",l);var u=this._buffer.batchPayloads(e);a.send(u),this._buffer.markAsSent(e)},t.prototype._formatErrorMessageXdr=function(e,t){return e?"XDomainRequest,Response:"+j(e)||!1:t},t}(L.a)}}]);
//# sourceMappingURL=npm.microsoft+applicationinsights-channel-js@2.5.4.0532ced6d2c63e96459a.js.map