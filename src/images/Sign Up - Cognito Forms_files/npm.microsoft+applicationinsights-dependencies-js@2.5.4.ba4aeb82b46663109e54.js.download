(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{705:function(e,t,a){"use strict";a.d(t,"a",(function(){return L}));var r=a(19),n=a(29),i=a(16),o=a(31),s=a(141),u=a(395),c=a(411),d=a(64),l=a(18),p=a(24),f=a(25),h=a(700),g=a(416),m=a(22),x=a(87),b=l.a.objKeys,q=l.a.arrForEach;function T(e,t,a){var r=0,i=e[t],o=e[a];return i&&o&&(r=n.c.GetDuration(i,o)),r}function v(e,t,a,r,i){var o=0,s=T(a,r,i);return s&&(o=j(e,t,n.e.msToTimeSpan(s))),o}function j(e,t,a){var r=0;e&&t&&a&&((e.ajaxPerf=e.ajaxPerf||{})[t]=a,r=1);return r}var D=function(){this.openDone=!1,this.setRequestHeaderDone=!1,this.sendDone=!1,this.abortDone=!1,this.stateChangeAttached=!1},H=function e(t,a,r){var i=r;this.perfMark=null,this.completed=!1,this.requestHeadersSize=null,this.requestHeaders=null,this.responseReceivingDuration=null,this.callbackDuration=null,this.ajaxTotalDuration=null,this.aborted=0,this.pageUrl=null,this.requestUrl=null,this.requestSize=0,this.method=null,this.status=null,this.requestSentTime=null,this.responseStartedTime=null,this.responseFinishedTime=null,this.callbackFinishedTime=null,this.endTime=null,this.xhrMonitoringState=new D,this.clientFailure=0,this.traceID=t,this.spanID=a,Object(x.a)(e,this,(function(e){e.getAbsoluteUrl=function(){return e.requestUrl?n.d.getAbsoluteUrl(e.requestUrl):null},e.getPathName=function(){return e.requestUrl?m.a.sanitizeUrl(i,n.d.getCompleteUrl(e.method,e.requestUrl)):null},e.CreateTrackItem=function(t,a,r){if(e.ajaxTotalDuration=Math.round(1e3*n.c.GetDuration(e.requestSentTime,e.responseFinishedTime))/1e3,e.ajaxTotalDuration<0)return null;var i,o=((i={id:"|"+e.traceID+"."+e.spanID,target:e.getAbsoluteUrl(),name:e.getPathName(),type:t,duration:e.ajaxTotalDuration,success:+e.status>=200&&+e.status<400,responseCode:+e.status,method:e.method}).properties={HttpMethod:e.method},i);if(function(e,t){var a=e.perfTiming,r=t.properties||{},n=0,i=l.a.isString,o="redirect",s=o+"Start",u=o="End";if(a){n|=v(r,o,a,s,u),n|=v(r,"domainLookup",a,"domainLookupStart","domainLookupEnd"),n|=v(r,"connect",a,"connectStart","connectEnd"),n|=v(r,"request",a,"requestStart","requestEnd"),n|=v(r,"response",a,"responseStart","responseEnd"),n|=v(r,"networkConnect",a,"startTime","connectEnd"),n|=v(r,"sentRequest",a,"requestStart","responseEnd");var c=a.duration;c||(c=T(a,"startTime","responseEnd")||0),n|=j(r,"duration",c),n|=j(r,"perfTotal",c);var d=a.serverTiming;if(d){var p={};q(d,(function(e,t){var a=Object(l.c)(e.name||""+t),r=p[a]||{};q(b(e),(function(t){var a=e[t];("name"!==t&&i(a)||l.a.isNumber(a))&&(r[t]&&(a=r[t]+";"+a),!a&&i(a)||(r[t]=a))})),p[a]=r})),n|=j(r,"serverTiming",p)}n|=j(r,"transferSize",a.transferSize),n|=j(r,"encodedBodySize",a.encodedBodySize),n|=j(r,"decodedBodySize",a.decodedBodySize)}else e.perfMark&&(n|=j(r,"missing",e.perfAttempts));n&&(t.properties=r)}(e,o),a&&b(e.requestHeaders).length>0&&(o.properties=o.properties||{},o.properties.requestHeaders=e.requestHeaders),r){var s=r();if(s){var u=s.correlationContext;if(u&&(o.correlationContext=u),s.headerMap&&b(s.headerMap).length>0&&(o.properties=o.properties||{},o.properties.responseHeaders=s.headerMap),e.status>=400){var c=s.type;o.properties=o.properties||{},""!==c&&"text"!==c||(o.properties.responseText=s.responseText?s.statusText+" - "+s.responseText:s.statusText),"json"===c&&(o.properties.responseText=s.response?s.statusText+" - "+JSON.stringify(s.response):s.statusText)}}}return o}}))},C=function(){function e(t,a){this.traceFlag=e.DEFAULT_TRACE_FLAG,this.version=e.DEFAULT_VERSION,t&&e.isValidTraceId(t)?this.traceId=t:this.traceId=n.e.generateW3CId(),a&&e.isValidSpanId(a)?this.spanId=a:this.spanId=n.e.generateW3CId().substr(0,16)}return e.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==e},e.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==e},e.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},e.DEFAULT_TRACE_FLAG="01",e.DEFAULT_VERSION="00",e}(),y=l.a.isNullOrUndefined,I=l.a.arrForEach,M=l.a.objKeys,A=0;function F(e){var t="";try{y(e)||y(e.ajaxData)||y(e.ajaxData.requestUrl)||(t+="(url: '"+e.ajaxData.requestUrl+"')")}catch(e){}return t}function k(e,t,a,r,n){e.diagLog().throwInternal(f.a.CRITICAL,t,a,r,n)}function S(e,t,a,r,n){e.diagLog().throwInternal(f.a.WARNING,t,a,r,n)}function R(e,t,a){return function(r){k(e,t,a,{ajaxDiagnosticsMessage:F(r.inst),exception:n.e.dump(r.err)})}}function w(e,t){return e&&t?e.indexOf(t):-1}var L=function(e){function t(){var a=e.call(this)||this;a.identifier=t.identifier,a.priority=120;var r,g,m,b,q=Object(p.f)(),T=!1,v=!1,j=q&&q.host&&q.host.toLowerCase(),D=t.getEmptyConfig(),L=!1,E=0,U=!1,P=0,O=!1,N=[],X={};return Object(x.a)(t,a,(function(e,a){function x(e,t,a){N.push(Object(h.b)(e,t,a))}function q(e,t,a){var r=!1,n=((l.a.isString(t)?t:(t||{}).url||"")||"").toLowerCase(),i=w(n,"?"),o=w(n,"#");return(-1===i||-1!==o&&o<i)&&(i=o),-1!==i&&(n=n.substring(0,i)),y(e)?y(t)||(r="object"==typeof t&&!0===t[d.b]||!!a&&!0===a[d.b]):r=!0===e[d.b]||!0===n[d.b],r?X[n]||(X[n]=1):X[n]&&(r=!0),r}function W(e,t){var a=!0,r=v;return y(e)||(a=!0===t||!y(e.ajaxData)),r&&a}function _(e){try{var t=e.responseType;if(""===t||"text"===t)return e.responseText}catch(e){}return null}function z(t){try{var a=t.getAllResponseHeaders();if(null!==a)if(-1!==w(a.toLowerCase(),s.a.requestContextHeaderLowerCase)){var r=t.getResponseHeader(s.a.requestContextHeader);return n.b.getCorrelationContext(r)}}catch(a){S(e,f.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:F(t),exception:n.e.dump(a)})}}function V(e,t){if(t.requestUrl&&b&&U){var a=Object(p.h)();if(a&&l.a.isFunction(a.mark)){A++;var r=b+e+"#"+A;a.mark(r);var n=a.getEntriesByName(r);n&&1===n.length&&(t.perfMark=n[0])}}}function G(e,t,a,r){var n=t.perfMark,i=Object(p.h)(),o=D.maxAjaxPerfLookupAttempts,s=D.ajaxPerfLookupDelay,u=t.requestUrl,c=0;!function d(){try{if(i&&n){c++;for(var p=null,f=i.getEntries(),h=f.length-1;h>=0;h--){var g=f[h];if(g){if("resource"===g.entryType)g.initiatorType!==e||-1===w(g.name,u)&&-1===w(u,g.name)||(p=g);else if("mark"===g.entryType&&g.name===n.name){t.perfTiming=p;break}if(g.startTime<n.startTime-1e3)break}}}!n||t.perfTiming||c>=o||!1===t.async?(n&&l.a.isFunction(i.clearMarks)&&i.clearMarks(n.name),t.perfAttempts=c,a()):setTimeout(d,s)}catch(e){r(e)}}()}function B(t){var a="";try{y(t)||(a+="string"==typeof t?"(url: '"+t+"')":"(url: '"+t.url+"')")}catch(t){k(e,f.b.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:n.e.dump(t)})}return a}function J(t,a,r,i,o,s){function u(t,a,i){var o=i||{};o.fetchDiagnosticsMessage=B(r),a&&(o.exception=n.e.dump(a)),S(e,t,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",o)}i&&(i.responseFinishedTime=n.c.Now(),i.status=a,G("fetch",i,(function(){var t=i.CreateTrackItem("Fetch",L,o);t?e.trackDependencyDataInternal(t):u(f.b.FailedMonitorAjaxDur,null,{requestSentTime:i.requestSentTime,responseFinishedTime:i.responseFinishedTime})}),(function(e){u(f.b.FailedMonitorAjaxGetCorrelationHeader,e,null)})))}function K(t){if(t&&t.headers)try{var a=t.headers.get(s.a.requestContextHeader);return n.b.getCorrelationContext(a)}catch(a){S(e,f.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:B(t),exception:n.e.dump(a)})}}e.initialize=function(s,u,c,d){if(!e.isInitialized()){a.initialize(s,u,c,d);var j=e._getTelCtx(),C=t.getDefaultConfig();I(M(C),(function(e){D[e]=j.getConfig(t.identifier,e,C[e])}));var A=D.distributedTracingMode;if(L=D.enableRequestHeaderTracking,U=D.enableAjaxPerfTracking,P=D.maxAjaxCallsPerView,O=D.enableResponseHeaderTracking,m=A===i.a.AI||A===i.a.AI_AND_W3C,g=A===i.a.AI_AND_W3C||A===i.a.W3C,U){var E=s.instrumentationKey||"unkwn";b=E.length>5?"ai.ajxmn."+E.substring(E.length-5)+".":"ai.ajxmn."+E+"."}if(!1===D.disableAjaxTracking&&function(e){var t=!1;if(typeof XMLHttpRequest!==p.p&&!y(XMLHttpRequest)){var a=XMLHttpRequest[p.o];t=!(y(a)||y(a.open)||y(a.send)||y(a.abort))}try{" a ".trim()}catch(e){t=!1}if(t)try{(new XMLHttpRequest).ajaxData={};var r=XMLHttpRequest[p.o].open;XMLHttpRequest[p.o].open=r}catch(a){t=!1,k(e,f.b.FailedMonitorAjaxOpen,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:n.e.dump(a)})}return t}(e)&&!v&&(x(XMLHttpRequest,"open",{req:function(t,a,i,o){var s=t.inst,u=s.ajaxData;q(s,i)||!W(s,!0)||u&&u.xhrMonitoringState.openDone||function(t,a,i,o){var s=r&&r.telemetryTrace&&r.telemetryTrace.traceID||n.e.generateW3CId(),u=n.e.generateW3CId().substr(0,16),c=new H(s,u,e.diagLog());c.method=a,c.requestUrl=i,c.xhrMonitoringState.openDone=!0,c.requestHeaders={},c.async=o,t.ajaxData=c,function(t){t.ajaxData.xhrMonitoringState.stateChangeAttached=l.b.Attach(t,"readystatechange",(function(){try{t&&4===t.readyState&&W(t)&&function(t){var a=t.ajaxData;function r(a,r){var i=r||{};i.ajaxDiagnosticsMessage=F(t),a&&(i.exception=n.e.dump(a)),S(e,f.b.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",i)}a.responseFinishedTime=n.c.Now(),a.status=t.status,G("xmlhttprequest",a,(function(){try{var n=a.CreateTrackItem("Ajax",L,(function(){var e={statusText:t.statusText,headerMap:null,correlationContext:z(t),type:t.responseType,responseText:_(t),response:t.response};if(O){var a=t.getAllResponseHeaders();if(a){var r=a.trim().split(/[\r\n]+/),n={};I(r,(function(e){var t=e.split(": "),a=t.shift(),r=t.join(": ");n[a]=r})),e.headerMap=n}}return e}));n?e.trackDependencyDataInternal(n):r(null,{requestSentTime:a.requestSentTime,responseFinishedTime:a.responseFinishedTime})}finally{try{t.ajaxData=null}catch(e){}}}),(function(e){r(e,null)}))}(t)}catch(r){var a=n.e.dump(r);a&&-1!==w(a.toLowerCase(),"c00c023f")||k(e,f.b.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:F(t),exception:a})}}))}(t)}(s,a,i,o)},hkErr:R(e,f.b.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.")}),x(XMLHttpRequest,"send",{req:function(t,a){var r=t.inst,i=r.ajaxData;W(r)&&!i.xhrMonitoringState.sendDone&&(V("xhr",i),i.requestSentTime=n.c.Now(),r=e.includeCorrelationHeaders(i,void 0,void 0,r),i.xhrMonitoringState.sendDone=!0)},hkErr:R(e,f.b.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.")}),x(XMLHttpRequest,"abort",{req:function(e){var t=e.inst,a=t.ajaxData;W(t)&&!a.xhrMonitoringState.abortDone&&(a.aborted=1,a.xhrMonitoringState.abortDone=!0)},hkErr:R(e,f.b.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.")}),L&&x(XMLHttpRequest,"setRequestHeader",{req:function(e,t,a){var r=e.inst;W(r)&&(r.ajaxData.requestHeaders[t]=a)},hkErr:R(e,f.b.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.")}),v=!0),function(){var t=(a=Object(p.b)(),!a||y(a.Request)||y(a.Request[p.o])||y(a.fetch)?null:a.fetch);var a;if(!t)return;var i=Object(p.b)(),o=t.polyfill;!1===D.disableFetchTracking?(N.push(Object(h.a)(i,"fetch",{req:function(t,a,i){var s;if(T&&!q(null,a,i)&&(!o||!v)){var u=t.ctx();s=function(t,a){var i=r&&r.telemetryTrace&&r.telemetryTrace.traceID||n.e.generateW3CId(),o=n.e.generateW3CId().substr(0,16),s=new H(i,o,e.diagLog());s.requestSentTime=n.c.Now(),t instanceof Request?s.requestUrl=t?t.url:"":s.requestUrl=t;var u="GET";a&&a.method?u=a.method:t&&t instanceof Request&&(u=t.method);s.method=u;var c={};if(L){new Headers((a?a.headers:0)||t instanceof Request&&t.headers||{}).forEach((function(e,t){c[t]=e}))}return s.requestHeaders=c,V("fetch",s),s}(a,i);var c=e.includeCorrelationHeaders(s,a,i);c!==i&&t.set(1,c),u.data=s}},rsp:function(e,t){var a=e.ctx().data;a&&(e.rslt=e.rslt.then((function(t){return J(e,(t||{}).status,t,a,(function(){var e={statusText:t.statusText,headerMap:null,correlationContext:K(t)};if(O){var a={};t.headers.forEach((function(e,t){a[t]=e})),e.headerMap=a}return e})),t})).catch((function(r){throw J(e,0,t,a,null,{error:r.message}),r})))},hkErr:R(e,f.b.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.")})),T=!0):o&&N.push(Object(h.a)(i,"fetch",{req:function(e,t,a){q(null,t,a)}}));o&&(i.fetch.polyfill=o)}(),c.length>0&&c){for(var X=void 0,B=0;!X&&B<c.length;)c[B]&&c[B].identifier===o.PropertiesPluginIdentifier&&(X=c[B]),B++;X&&(r=X.context)}}},e.teardown=function(){I(N,(function(e){e.rm()})),N=[],T=!1,v=!1,e.setInitialized(!1)},e.trackDependencyData=function(t,a){e.trackDependencyDataInternal(t,a)},e.includeCorrelationHeaders=function(t,a,i,o){var u=e._currentWindowHost||j;if(a){if(n.b.canIncludeCorrelationHeader(D,t.getAbsoluteUrl(),u)){if(i||(i={}),i.headers=new Headers(i.headers||a instanceof Request&&a.headers||{}),m){var c="|"+t.traceID+"."+t.spanID;i.headers.set(s.a.requestIdHeader,c),L&&(t.requestHeaders[s.a.requestIdHeader]=c)}if((l=D.appId||r&&r.appId())&&(i.headers.set(s.a.requestContextHeader,s.a.requestContextAppIdFormat+l),L&&(t.requestHeaders[s.a.requestContextHeader]=s.a.requestContextAppIdFormat+l)),g){var d=new C(t.traceID,t.spanID);i.headers.set(s.a.traceParentHeader,d.toString()),L&&(t.requestHeaders[s.a.traceParentHeader]=d.toString())}}return i}if(o){if(n.b.canIncludeCorrelationHeader(D,t.getAbsoluteUrl(),u)){if(m){c="|"+t.traceID+"."+t.spanID;o.setRequestHeader(s.a.requestIdHeader,c),L&&(t.requestHeaders[s.a.requestIdHeader]=c)}var l;if((l=D.appId||r&&r.appId())&&(o.setRequestHeader(s.a.requestContextHeader,s.a.requestContextAppIdFormat+l),L&&(t.requestHeaders[s.a.requestContextHeader]=s.a.requestContextAppIdFormat+l)),g){d=new C(t.traceID,t.spanID);o.setRequestHeader(s.a.traceParentHeader,d.toString()),L&&(t.requestHeaders[s.a.traceParentHeader]=d.toString())}}return o}},e.trackDependencyDataInternal=function(t,a,r){if(-1===P||E<P){D.distributedTracingMode!==i.a.W3C&&D.distributedTracingMode!==i.a.AI_AND_W3C||"string"!=typeof t.id||"."===t.id[t.id.length-1]||(t.id+=".");var n=u.a.create(t,c.a.dataType,c.a.envelopeType,e.diagLog(),a,r);e.core.track(n)}else E===P&&k(e,f.b.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++E}})),a}return r.b(t,e),t.getDefaultConfig=function(){return{maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,disableCorrelationHeaders:!1,distributedTracingMode:i.a.AI,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1,enableAjaxErrorStatusText:!1,enableAjaxPerfTracking:!1,maxAjaxPerfLookupAttempts:3,ajaxPerfLookupDelay:25}},t.getEmptyConfig=function(){var e=this.getDefaultConfig();return I(M(e),(function(t){e[t]=void 0})),e},t.prototype.processTelemetry=function(e,t){this.processNext(e,t)},t.identifier="AjaxDependencyPlugin",t}(g.a)}}]);
//# sourceMappingURL=npm.microsoft+applicationinsights-dependencies-js@2.5.4.ba4aeb82b46663109e54.js.map