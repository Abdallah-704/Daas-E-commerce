(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{701:function(t,e,i){"use strict";var s=i(19),n=i(18),o=i(110),a=i(25),r=i(24),c=i(416),p=i(29),h=function(){},u=function(){function t(e,i){var s=this;n.a.isNullOrUndefined(i)?this._logger=new o.a:this._logger=i,e||(e={}),"function"!=typeof e.sessionExpirationMs&&(e.sessionExpirationMs=function(){return t.acquisitionSpan}),"function"!=typeof e.sessionRenewalMs&&(e.sessionRenewalMs=function(){return t.renewalSpan}),this.config=e,this._storageNamePrefix=function(){return s.config.namePrefix&&s.config.namePrefix()?t.cookieNameConst+s.config.namePrefix():t.cookieNameConst},this.automaticSession=new h}return t.prototype.update=function(){this.automaticSession.id||this.initializeAutomaticSession();var e=p.c.Now(),i=0!==this.config.sessionExpirationMs()&&e-this.automaticSession.acquisitionDate>this.config.sessionExpirationMs(),s=0!==this.config.sessionExpirationMs()&&e-this.automaticSession.renewalDate>this.config.sessionRenewalMs();i||s?this.renew():(!this.cookieUpdatedTimestamp||e-this.cookieUpdatedTimestamp>t.cookieUpdateInterval)&&(this.automaticSession.renewalDate=e,this.setCookie(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate))},t.prototype.backup=function(){this.setStorage(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate)},t.prototype.initializeAutomaticSession=function(){var t=p.e.getCookie(this._logger,this._storageNamePrefix());if(t&&"function"==typeof t.split)this.initializeAutomaticSessionWithData(t);else{var e=p.e.getStorage(this._logger,this._storageNamePrefix());e&&this.initializeAutomaticSessionWithData(e)}this.automaticSession.id||this.renew()},t.prototype.initializeAutomaticSessionWithData=function(t){var e=t.split("|");e.length>0&&(this.automaticSession.id=e[0]);try{if(e.length>1){var i=+e[1];this.automaticSession.acquisitionDate=+new Date(i),this.automaticSession.acquisitionDate=this.automaticSession.acquisitionDate>0?this.automaticSession.acquisitionDate:0}if(e.length>2){var s=+e[2];this.automaticSession.renewalDate=+new Date(s),this.automaticSession.renewalDate=this.automaticSession.renewalDate>0?this.automaticSession.renewalDate:0}}catch(t){this._logger.throwInternal(a.a.CRITICAL,a.b.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+p.e.getExceptionName(t),{exception:p.e.dump(t)})}0===this.automaticSession.renewalDate&&this._logger.throwInternal(a.a.WARNING,a.b.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")},t.prototype.renew=function(){var t=p.c.Now();this.automaticSession.id=p.e.newId(),this.automaticSession.acquisitionDate=t,this.automaticSession.renewalDate=t,this.setCookie(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate),p.e.canUseLocalStorage()||this._logger.throwInternal(a.a.WARNING,a.b.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")},t.prototype.setCookie=function(t,e,i){var s=e+this.config.sessionExpirationMs(),n=i+this.config.sessionRenewalMs(),o=new Date,a=[t,e,i];s<n?o.setTime(s):o.setTime(n);var r=this.config.cookieDomain?this.config.cookieDomain():null,c=0===this.config.sessionExpirationMs()?"0":o.toUTCString();p.e.setCookie(this._logger,this._storageNamePrefix(),a.join("|")+";expires="+c,r),this.cookieUpdatedTimestamp=p.c.Now()},t.prototype.setStorage=function(t,e,i){p.e.setStorage(this._logger,this._storageNamePrefix(),[t,e,i].join("|"))},t.acquisitionSpan=864e5,t.renewalSpan=18e5,t.cookieUpdateInterval=6e4,t.cookieNameConst="ai_session",t}(),l=i(172),g=function(){},d=function(){this.id="browser",this.deviceClass="Browser"},f=function(t){this.sdkVersion=(t.sdkExtension&&t.sdkExtension()?t.sdkExtension()+"_":"")+"javascript:2.5.4"},x=function(){function t(e,i){this.isNewUser=!1,this._logger=i;var s=p.e.getCookie(this._logger,t.userCookieName);if(s){this.isNewUser=!1;var o=s.split(t.cookieSeparator);o.length>0&&(this.id=o[0])}if(this.config=e,!this.id){this.id=p.e.newId();var a=new Date,r=n.a.toISOString(a);this.accountAcquisitionDate=r,this.isNewUser=!0,a.setTime(a.getTime()+31536e6);var c=[this.id,r],h=this.config.cookieDomain?this.config.cookieDomain():void 0;p.e.setCookie(this._logger,t.userCookieName,c.join(t.cookieSeparator)+";expires="+a.toUTCString(),h);var u=e.namePrefix&&e.namePrefix()?e.namePrefix()+"ai_session":"ai_session";p.e.removeStorage(this._logger,u)}this.accountId=e.accountId?e.accountId():void 0;var l=p.e.getCookie(this._logger,t.authUserCookieName);if(l){var g=(l=decodeURI(l)).split(t.cookieSeparator);g[0]&&(this.authenticatedId=g[0]),g.length>1&&g[1]&&(this.accountId=g[1])}}return t.prototype.setAuthenticatedUserContext=function(e,i,s){if(void 0===s&&(s=!1),!this.validateUserInput(e)||i&&!this.validateUserInput(i))this._logger.throwInternal(a.a.WARNING,a.b.SetAuthContextFailedAccountName,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);else{this.authenticatedId=e;var n=this.authenticatedId;i&&(this.accountId=i,n=[this.authenticatedId,this.accountId].join(t.cookieSeparator)),s&&p.e.setCookie(this._logger,t.authUserCookieName,encodeURI(n),this.config.cookieDomain())}},t.prototype.clearAuthenticatedUserContext=function(){this.authenticatedId=null,this.accountId=null,p.e.deleteCookie(this._logger,t.authUserCookieName)},t.prototype.validateUserInput=function(t){return!("string"!=typeof t||!t||t.match(/,|;|=| |\|/))},t.cookieSeparator="|",t.userCookieName="ai_user",t.authUserCookieName="ai_authUser",t}(),m=function(){},y=i(22),v=function(t,e,i,s){this.traceID=t||p.e.generateW3CId(),this.parentID=e,this.name=i;var n=Object(r.f)();!i&&n&&n.pathname&&(this.name=n.pathname),this.name=y.a.sanitizeString(s,this.name)},b=function(){function t(t,e){Object(r.l)()&&(this.sessionManager=new u(e,t),this.application=new g,this.device=new d,this.internal=new f(e),this.location=new m,this.user=new x(e,t),this.telemetryTrace=new v(void 0,void 0,void 0,t),this.session=new h),this.appId=function(){return null}}return t.prototype.applySessionContext=function(t,e){var i=this.session||this.sessionManager&&this.sessionManager.automaticSession;i&&"string"==typeof i.id&&(t.ext.app.sesId=i.id),this.session&&("string"==typeof this.session.id?t.ext.app.sesId=this.session.id:t.ext.app.sesId=this.sessionManager.automaticSession.id)},t.prototype.applyOperatingSystemContxt=function(t,e){this.os&&this.os.name&&(t.ext.os=this.os)},t.prototype.applyApplicationContext=function(t,e){this.application&&("string"==typeof this.application.ver&&(t.tags[l.a.applicationVersion]=this.application.ver),"string"==typeof this.application.build&&(t.tags[l.a.applicationBuild]=this.application.build))},t.prototype.applyDeviceContext=function(t,e){this.device&&("string"==typeof this.device.id&&(t.ext.device.localId=this.device.id),"string"==typeof this.device.ip&&(t.ext.device.ip=this.device.ip),"string"==typeof this.device.model&&(t.ext.device.model=this.device.model),"string"==typeof this.device.deviceClass&&(t.ext.device.deviceClass=this.device.deviceClass))},t.prototype.applyInternalContext=function(t,e){this.internal&&("string"==typeof this.internal.agentVersion&&(t.tags[l.a.internalAgentVersion]=this.internal.agentVersion),"string"==typeof this.internal.sdkVersion&&(t.tags[l.a.internalSdkVersion]=this.internal.sdkVersion))},t.prototype.applyLocationContext=function(t,e){this.location&&"string"==typeof this.location.ip&&(t.tags[l.a.locationIp]=this.location.ip)},t.prototype.applyOperationContext=function(t,e){if(this.telemetryTrace){var i=t.ext.trace||{traceID:void 0,parentID:void 0};"string"==typeof this.telemetryTrace.traceID&&(i.traceID=this.telemetryTrace.traceID),"string"==typeof this.telemetryTrace.name&&(i.name=this.telemetryTrace.name),"string"==typeof this.telemetryTrace.parentID&&(i.parentID=this.telemetryTrace.parentID),t.ext.trace=i}},t.prototype.applyWebContext=function(t,e){this.web&&(t.ext.web=t.ext.web||{},t.ext.web=this.web)},t.prototype.applyUserContext=function(t,e){if(this.user){if(t.tags||(t.tags=[]),"string"==typeof this.user.accountId){t.tags[l.a.userAccountId]=this.user.accountId}"string"==typeof this.user.id&&(t.ext.user.id=this.user.id),"string"==typeof this.user.authenticatedId&&(t.ext.user.authId=this.user.authenticatedId)}},t.prototype.cleanUp=function(t,e){t.ext[l.b.DeviceExt]&&0===n.a.objKeys(t.ext[l.b.DeviceExt]).length&&delete t.ext[l.b.DeviceExt],t.ext[l.b.UserExt]&&0===n.a.objKeys(t.ext[l.b.UserExt]).length&&delete t.ext[l.b.UserExt],t.ext[l.b.WebExt]&&0===n.a.objKeys(t.ext[l.b.WebExt]).length&&delete t.ext[l.b.WebExt],t.ext[l.b.OSExt]&&0===n.a.objKeys(t.ext[l.b.OSExt]).length&&delete t.ext[l.b.OSExt],t.ext[l.b.AppExt]&&0===n.a.objKeys(t.ext[l.b.AppExt]).length&&delete t.ext[l.b.AppExt],t.ext[l.b.TraceExt]&&0===n.a.objKeys(t.ext[l.b.TraceExt]).length&&delete t.ext[l.b.TraceExt]},t}(),w=i(31),I=i(392),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.priority=110,e.identifier=w.PropertiesPluginIdentifier,e}return s.b(e,t),e.getDefaultConfig=function(){return{instrumentationKey:function(){},accountId:function(){return null},sessionRenewalMs:function(){return 18e5},samplingPercentage:function(){return 100},sessionExpirationMs:function(){return 864e5},cookieDomain:function(){return null},sdkExtension:function(){return null},isBrowserLinkTrackingEnabled:function(){return!1},appId:function(){return null},namePrefix:function(){}}},e.prototype.initialize=function(i,s,n,o){var a=this;t.prototype.initialize.call(this,i,s,n,o);var r=this._getTelCtx(),c=this.identifier,h=e.getDefaultConfig();this._extensionConfig=this._extensionConfig||e.getDefaultConfig();var u=function(t){l._extensionConfig[t]=function(){return r.getConfig(c,t,h[t]())}},l=this;for(var g in h)u(g);this.context=new b(s.logger,this._extensionConfig),this._breezeChannel=p.e.getExtension(n,w.BreezeChannelIdentifier),this.context.appId=function(){return a._breezeChannel?a._breezeChannel._appId:null}},e.prototype.processTelemetry=function(t,e){if(n.a.isNullOrUndefined(t));else{if(e=this._getTelCtx(e),t.name===I.a.envelopeType&&e.diagLog().resetInternalMessageCount(),this.context.session&&"string"!=typeof this.context.session.id&&this.context.sessionManager.update(),this._processTelemetryInternal(t,e),this.context&&this.context.user&&this.context.user.isNewUser){this.context.user.isNewUser=!1;var i=new o.b(a.b.SendBrowserInfoOnUserInit,(Object(r.g)()||{}).userAgent||"");e.diagLog().logInternalMessage(a.a.CRITICAL,i)}this.processNext(t,e)}},e.prototype._processTelemetryInternal=function(t,e){t.tags||(t.tags=[]),t.ext||(t.ext={});var i=t.ext;i[l.b.DeviceExt]=i[l.b.DeviceExt]||{},i[l.b.WebExt]=i[l.b.WebExt]||{},i[l.b.UserExt]=i[l.b.UserExt]||{},i[l.b.OSExt]=i[l.b.OSExt]||{},i[l.b.AppExt]=i[l.b.AppExt]||{},i[l.b.TraceExt]=i[l.b.TraceExt]||{};var s=this.context;s.applySessionContext(t,e),s.applyApplicationContext(t,e),s.applyDeviceContext(t,e),s.applyOperationContext(t,e),s.applyUserContext(t,e),s.applyOperatingSystemContxt(t,e),s.applyWebContext(t,e),s.applyLocationContext(t,e),s.applyInternalContext(t,e),s.cleanUp(t,e)},e}(c.a);e.a=S}}]);
//# sourceMappingURL=npm.microsoft+applicationinsights-properties-js@2.5.4.e4f0678a4012b1fd9062.js.map